{% extends "base.html" %}
{% load staticfiles tournament_extras %}

{% block title %}{{ league.name }}{% endblock %}

{% block home_link %}/{% endblock %}

{% block content %}
<div class="row row-condensed-xs home-row">
	<div class="col-md-6 col-xs-12">
		{% if intro_doc %}
		<div class="well">
			<div class="well-head">
				<div class="inline">
					<h3>{{ intro_doc.document.name }}</h3>
				</div>{% if can_edit_document %}
				<div class="inline document-edit">
					<a href="{% url 'admin:tournament_document_change' intro_doc.document.pk %}?_popup=1" id="change-document-{{ intro_doc.document.pk }}" class="large-popup-link" title="Change selected document">
			            <img src="{% static 'admin/img/icon-changelink.svg' %}" alt="Change">
			        </a>
		        </div>{% endif %}
		    </div>
		    <div class="well-body">
				{{ intro_doc.document.content|safe }}
				{% if rules_doc_tag %}
				<a href="{% leagueurl 'document' league_tag season_tag rules_doc_tag %}" class="btn btn-default">Rules and Regulations</a>
				{% endif %}
			</div>
		</div>
		{% endif %}
		{% if registration_season %}
		<div class="well">
			<div class="well-head">
				<h3>Registration is open!</h3>
			</div>
		    <div class="well-body">
		    	{% if registration_season.is_started %}
		    	<p>{{ registration_season.name }} ends on {{ registration_season.end_date|date_or_q }}.</p>
		    	{% else %}
				<p>{{ registration_season.name }} starts on {{ registration_season.start_date|date_or_q }}.</p>
				{% endif %}
				<a href="{% leagueurl 'register' league_tag season_tag %}" class="btn btn-default">Register Now</a>
			</div>
		</div>
		{% endif %}
		{% if current_games or upcoming_games %}
		<div class="well">
			<div class="well-head">
				<h3>Ongoing Games</h3>
			</div>
		    <div class="well-body">
				{% if current_games %}
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Players</th>
							<th>Start Time</th>
						</tr>
					</thead>
					<tbody>
						{% for pairing in current_games %}
						<tr>
							<td><a href="{{ pairing.game_link }}">{{ pairing.white }} - {{ pairing.black }}</a></td>
							<td>{{ pairing.scheduled_time | date:"H:i" }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% endif %}
				{% if upcoming_games %}
				<h4>Starting Soon</h4>
				<table class="table">
					<tr>
						<th>Players</th>
						<th>Start Time</th>
					</tr>
					{% for pairing in upcoming_games %}
					<tr>
						<td>{{ pairing.white }} - {{ pairing.black }}</td>
						<td>{{ pairing.scheduled_time | date:"H:i" }}</td>
					</tr>
					{% endfor %}
				</table>
				{% endif %}
				<p>All times are in UTC.</p>
			</div>
		</div>
		{% endif %}
	</div>
	<div class="col-md-6 col-xs-12">
		{% if player_scores %}
		<div class="well">
			<div class="well-head">
				<h3>{{ season.name }} {% if season.is_completed %}Final {% endif %}Standings</h3>
			</div>
			<div class="well-body">
				<table class="table table-striped">
					<thead>
						<tr>
							<th></th>
							<th>Name</th>
							<th class="text-center">Rtng</th>
							<th class="text-center">Total</th>
							<th class="text-center">TBrk[M]</th>
						</tr>
					</thead>
					<tbody>
						{% for number, player_score, round_scores in player_scores %}
						<tr>
							<td class="text-center rank-value">{{ number }}</td>
							<td class="{% highlightclass player_highlights player_score.season_player.player %}">
								<a href="{% leagueurl 'player_profile' league_tag season_tag player_score.season_player.player.lichess_username %}">
									{{ player_score.season_player.player.lichess_username }}
								</a>
							</td>
							<td class="text-center">{{ player_score.season_player.player.rating }}</td>
							<td class="text-center rank-value">{{ player_score.final_standings_points_display }}</td>
							<td class="text-center rank-value">{{ player_score.tiebreak1_display }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% if not season.is_completed %}
				<a href="{% leagueurl 'standings' league_tag season_tag %}" class="btn btn-default">Full Standings</a>
				{% endif %}
				<a href="{% leagueurl 'season_landing' league_tag season_tag %}" class="btn btn-default">Season Details</a>
			</div>
		</div>
		{% endif %}
		{% if season_list %}
		<div class="well">
			<div class="well-head">
				<h3>Previous Seasons</h3>
			</div>
		    <div class="well-body">
				<div class="dropdown">
				    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
				        Choose a Season
				        <span class="caret"></span>
				    </button>
				    <ul class="dropdown-menu">
					    {% for s in season_list %}
					    <li><a href="{% leagueurl 'season_landing' league_tag s.tag %}">{{ s.name }}</a></li>
					    {% endfor %}
				    </ul>
				</div>
			</div>
		</div>
		{% endif %}
		{% if other_leagues %}
		<div class="well">
			<div class="well-head">
				<h3>Other Leagues</h3>
			</div>
		    <div class="well-body">
		    	{% for l in other_leagues %}
		    	<div class="league-link league-link-{{ l.theme }}">
					<a href="{% leagueurl 'league_home' l.tag None %}" class="btn btn-default">{{ l.name }}</a>
				</div>
				{% endfor %}
			</div>
		</div>
		{% endif %}
	</div>
</div>
{% endblock %}
